\section{Single DAG Query}

\subsection{Model}

Let $\mathcal{L}$ be the set of sites that holds data and runs tasks.
For each inter-site WAN link, let $B_{ij}$ be the bandwidth from site $i\in\mathcal{L}$ to site $j\in\mathcal{L}$.
We assume that the bandwidths are stable within the time frame of doing real-time data analytics.

Let $\mathcal{N}$ be the set of nodes and $\mathcal{D}$ be the directed set of edges respectively, for the DAG of a Query Execution Plan (QEP).
We define $D_i^k$ as the amount of input data for node $k$ at site $i$, and $r_j^k$ as the fraction of tasks for node $k$ assigned to site $j$.
We denote $\alpha^k$ as the selectivity for node $k$ which is the proportional data shrinkage/expansion from placed tasks at each of the sites.
For each node $l$ in the DAG that has predecessors, the sum of the predecessor nodes' output data becomes the input data: 
\begin{align}
	\sum_{j\in\mathcal{L}}D_j^l = \sum_{k:(k,l)\in\mathcal{D}}\alpha^k\sum_{i\in\mathcal{L}}D_i^k.
\end{align}
We assume that each node in the QEP requires a data shuffle which means that
\begin{align}
	D_j^l = \sum_{k:(k,l)\in\mathcal{D}}\alpha^kr_j^k\sum_{i\in\mathcal{L}}D_i^k.
\end{align}

We also have that the total WAN usage is:
\begin{align}
	\sum_{k\in\mathcal{N}}\sum_{i\in\mathcal{L}}\sum_{j\in\mathcal{L}:j\neq i}D_i^kr_j^k
\end{align}
which can like previously be rearranged to
\begin{align}
	\sum_{k\in\mathcal{N}}\sum_{i\in\mathcal{L}}\sum_{j\in\mathcal{L}:j\neq i}D_i^kr_j^k & = \sum_{k\in\mathcal{N}}\left(\sum_{i\in\mathcal{L}}D_i^k - \sum_{j\in\mathcal{L}}D_j^kr_j^k\right) \\
	& =\sum_{k\in\mathcal{N}}\sum_{j\in\mathcal{L}}D_j^k(1-r_j^k)
\end{align}

\subsection{Problem}

\subsubsection*{Minimize WAN usage}

When minimizing WAN usage for a DAG we have the following optimization problem:
\begin{subequations}
	\begin{align}
		\min_{r,D} \quad & \sum_{k\in\mathcal{N}}\sum_{j\in\mathcal{L}}D_j^k(1-r_j^k) \\
		\text{s.t.} \quad & \sum_{j}r_j^k = 1 \quad \forall k\in\mathcal{N}\\
		& r_j^k \geq 0 \quad \forall j\in\mathcal{L},\forall k\in\mathcal{N} \\
		& D_j^l = \sum_{k:(k,l)\in\mathcal{D}}\alpha^kr_j^k\sum_{i\in\mathcal{L}}D_i^k \quad \forall l\in\mathcal{N}
	\end{align}
\end{subequations}
Even without adding deadlines, this problem has nonlinear terms in the objective function and the last equality constraint.